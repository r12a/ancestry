<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Death form</title>
<link href="../../lib/style.css" rel="stylesheet">
<style>
td { vertical-align: top; padding-left: 1em; }
details { margin-left: 2em; }
</style>
<script src="formentrylookup.js"></script>
<script src="getplacenames.js"></script>
<script>
trace = false
// read in project
var project
parameters = location.search.split('&');
parameters[0] = parameters[0].substring(1);
for (var p=0;p<parameters.length;p++) {  
	pairs = parameters[p].split('=');
	if (pairs[0] == 'project') { if (pairs[1]) { var project = pairs[1] } }
	if (pairs[0] == 'person' && pairs[1]) { var theperson = pairs[1] }
	}

// load the appropriate db file	
if (! project) alert('Specify the project name in the URL, using ?project=...')
var db = document.createElement('script');
db.src = '../../'+project+'/db.js'
db.async = false
document.head.appendChild(db);



// load the appropriate census file	
var db = document.createElement('script')
db.src = '../../'+project+'/census.js'
db.async = false
document.head.appendChild(db)





if (theperson) {
    setTimeout(() => autoPropagate(theperson), 1000)
    }







function openWindow (locn) {
    const windowFeatures = "left=50,top=50";
	//var newwindow = window.open(locn, 'newwindow', windowFeatures) 
	var newwindow = window.open(locn, 'newwindow') 
	newwindow.focus()
	}

function openRecord (locn, ext) {
	var newwindow = window.open('../../'+project+'_records/'+locn+ext, 'newwindow') 
	output.focus()
	newwindow.focus()
	}


function makeNotes (content, target) {
	segments = content.split('\n')
	var out = ''
	for (var i=0;i<segments.length;i++) out += '<div>&quot;'+target+': '+segments[i]+'&quot;,</div>'
	document.getElementById(target).innerHTML = out
	}






function autoPropagate (person) {
    // Pull up a list of ids for related people, and fill in some fields automatically
    if (person === '') {
        alert('No id provided.')
        return
        }
    
    // add id for parameter driven use
    document.getElementById('idIn').value = person


    // populate the places datalist
    findallplaces()
    makePlacesDatalist()


    // make a list of relatives to the right
	listRelations(person)
    
    // fill in the page building data
    if (db[person] && db[person].death) {
        var dataItems = db[person].death
    
        var notes = ''
        var fnotes = ''
        var discussion = ''
        
        if (dataItems.timestamp) document.getElementById('timestampIn').value = dataItems.timestamp.trim()
        
        
        if (db[person].d) document.getElementById('deathYearIn').value = db[person].d

        if (db[person].ddate) document.getElementById('deathDateIn').value = db[person].ddate


        if (dataItems.of) document.getElementById('ofIn').value = dataItems.of.trim()

        if (dataItems.place) document.getElementById('deathPlaceIn').value = dataItems.place.trim()

        if (dataItems.age) document.getElementById('ageIn').value = dataItems.age.trim()

        if (dataItems.cause) document.getElementById('causeIn').value = dataItems.cause.trim()
        
        if (dataItems.occ) document.getElementById('occIn').value = dataItems.occ.trim()
        
        if (dataItems.informant) document.getElementById('informantIn').value = dataItems.informant.trim()
        
        if (dataItems.mentioned) document.getElementById('mentionedIn').value = dataItems.mentioned.trim()
        
        if (dataItems.burplace) document.getElementById('burPlaceIn').value = dataItems.burplace.trim()
        
        if (dataItems.buryear) document.getElementById('burYearIn').value = dataItems.buryear.trim()
        
        if (dataItems.burdate) document.getElementById('burDateIn').value = dataItems.burdate.trim()
        
        if (dataItems.denomination) document.getElementById('denominationIn').value = dataItems.denomination.trim()
        
        if (dataItems.namedInProbate) document.getElementById('probateNamesIn').value = dataItems.namedInProbate.trim()
        
        
        if (dataItems.gravestone) document.getElementById('graveTextIn').value = dataItems.gravestone.trim()
        
        if (dataItems.probate) document.getElementById('probateTextIn').value = dataItems.probate.trim()

        if (dataItems.gps) {
            var fields = dataItems.gps[0].split('https:') 
            //document.getElementById('gpsPlace').value += fields[0].trim()
            //document.getElementById('gpsCoords').value = fields[1].replace('//maps.google.com/maps?q=','').trim()
            }
        
        
        if (dataItems.notes) document.getElementById('censusNotes').value = dataItems.notes.trim()
        
        if (dataItems.fnotes) {
            out = ''
            for (i=0;i<dataItems.fnotes.length;i++)  out += `${ dataItems.fnotes[i] }\n`
            document.getElementById('censusFNotes').value = out
            }

        if (dataItems.discussion) document.getElementById('censusDisc').value = dataItems.discussion.trim()
        
        if (dataItems.caution) document.getElementById('cautionIn').value = dataItems.caution.trim()
        
       
         if (dataItems.gps) {
            out = ''
            for (i=0;i<dataItems.gps.length;i++)  out += `${ dataItems.gps[i].replace(/ https:\/\/maps.google.com\/maps\?q=/,':') }\n`
            document.getElementById('gpsIn').value = out
            }


         if (dataItems.images) {
            out = ''
            for (i=0;i<dataItems.images.length;i++)  out += `${ dataItems.images[i].replace(/url:records\//,'') }\n`
            document.getElementById('recordsIn').value = out
            }


        // get sources
        if (dataItems.sources) {        
            formatSource(dataItems.sources, '')
            }

        draftResult()
        }
    
    // set parameters for links at top of the page
    document.getElementById('birthLink').href = `birthentry.html?project=${ project }&person=${ theperson }`
    document.getElementById('marriageLink').href = `marriageentry.html?project=${ project }&person=${ theperson }`
    document.getElementById('censusLink').href = `censusentry.html?project=${ project }&person=${ theperson }`
    document.getElementById('eventLink').href = `evententry.html?project=${ project }&person=${ theperson }`

	}



function formatSource (sources, discussion) {
    // wrap source lines in link markup
    if (trace) console.log(enter, 'formatSource(',sources,')')

    if (typeof sources === 'undefined') return ''
    
    var sourceList = sources.split('SOURCE:')
    console.log(sourceList)
    
    var counter = 0
    for (s=0;s<sourceList.length;s++) {
        if (sourceList[s].trim() === '') continue
        
        // assign the output area names
        switch (counter) {
            case 0: target = 'index'; break
            case 1: target = 'second'; break
            case 2: target = 'bur'; break
            case 3: target = 'fourth'; break
            }
        counter++
        console.log(target, sourceList[s])
    
        var lines = sourceList[s].split('\n')
        for (var i=0;i<lines.length;i++) {
            if (lines[0].includes('http')) {
                parts = lines[0].split('http')
                document.getElementById(target+'SourceIn').value = parts[0].trim()
                document.getElementById(target+'SourceURLIn').value = `http${ parts[1]}`
                body = ''
                for (j=1;j<lines.length;j++) body += lines[j]+'\n'
                document.getElementById(target+'PastedIn').value = body
                document.getElementById(target).open = true
                }
            else if (lines[i].match('SOURCE') && lines[i].match('url:')) {
                parts = lines[i].split('url:')
                parts[0] = parts[0].replace(/SOURCE: /,'')
                lines[i] = `<img src="lib/i/source.png" alt="Source link" title="Source link"><a target="_blank" href="${ window.project }/${ parts[1] }">${ parts[0] }</a>`
                }
            else {
                title = lines[0].replace(/SOURCE: /,'')
                document.getElementById(target+'SourceIn').value = title.trim()
                body = ''
                for (j=1;j<lines.length;j++) body += lines[j]+'\n'
                document.getElementById(target+'PastedIn').value = body
                document.getElementById(target).open = true
                }
            }
            }
    
    sources = lines.join('\n').replace(/\[|\]/g,'')
    
    if (discussion) sources += '\n<img src="lib/i/discn.png" alt="Commentary" title="Commentary">'+discussion
    
    if (trace) console.log(exit,'formatSource:',sources)
    return sources
    }



function addQuotesTo (content) { 
    // quotes no longer needed. Just normalisation of lines.
	var out = ''
	var lines = content.split('\n')
	for (var i=0;i<lines.length;i++) {
        if (! lines[i].includes(':')) lines[i] = lines[i].replace(/\t/,': ')
        lines[i] = lines[i].replace(/\s+/g,' ')
		out += lines[i].trim()
        if (i<lines.length-1) out += '\n'
		}
	return out
	}




function clearAll () {
	inputs = document.querySelectorAll('input, textarea')
	for (var i=0;i<inputs.length;i++) inputs[i].value = ''
	
	divs =  document.getElementById('draft').querySelectorAll('div')
	for (i=0;i<divs.length;i++) divs[i].textContent = ''
	document.getElementById('discussion').textContent = '"discussion: "'
	document.getElementById('start').textContent = '"death": ['
	document.getElementById('end').textContent = "]"
	}

function formatGPS (str) {
	str = str.replace(/https:\/\/maps.google.com\/maps\?q=/,'')
	str = str.trim().replace(/,/,' ').replace(/\s+/,',')
	return str
	}
</script>
<style>
#draft p {
	margin: 0;
	}
#references, #certificateTemplate, #parishTemplate {
    clear: right;
	font-size: 80%;
	float: right;
    margin-block-start: 4rem;
	}
#references p, #certificateTemplate p, #parishTemplate p {
	margin: 0;
	}
#references h3, #certificateTemplate h3, #parishTemplate h3 {
	margin-bottom: 0;
	}
.redo { font-size:120%; margin-left: 1em; cursor: pointer; }
.copy { margin-left: 2em; cursor: pointer; background-color: rgba(107,167,227,1.00); color: white; border-radius: 5px; }
.copy:hover { background-color: rgba(11,124,236,1.00); color: white; border-radius: 5px; }
.heading { font-weight:bold; padding-top: 1em; font-size: 110%; }
</style>

<script>



function draftResult () {
    // called each time a field is changed; updates the output
    
    //document.getElementById('id').textContent = `"id: ${ document.getElementById('idIn').value.trim() }",`


// index
    if (document.getElementById('indexSourceIn').value.trim() || document.getElementById('indexSourceURLIn').value.trim())
        document.getElementById('indexSource').textContent = `SOURCE: ${ document.getElementById('indexSourceIn').value.trim() }  ${ document.getElementById('indexSourceURLIn').value.trim() }` 
    else document.getElementById('indexSource').textContent = ''
 
    if (document.getElementById('indexPastedIn').value.trim()) 
        document.getElementById('indexPasted').textContent = addQuotesTo(document.getElementById('indexPastedIn').value.trim())
    else document.getElementById('indexPasted').textContent = ''
 
    if (document.getElementById('indexTextIn').value.trim()) 
        document.getElementById('indexText').textContent = `text: ${ document.getElementById('indexTextIn').value.trim() }`
    else document.getElementById('indexText').textContent = ''
 



// second source
    if (document.getElementById('secondSourceIn').value.trim() || document.getElementById('secondSourceURLIn').value.trim())
        document.getElementById('secondSource').textContent = `\nSOURCE: ${ document.getElementById('secondSourceIn').value.trim() }  ${ document.getElementById('secondSourceURLIn').value.trim() }` 
    else document.getElementById('secondSource').textContent = ''
 

    if (document.getElementById('secondPastedIn').value.trim()) 
        document.getElementById('secondPasted').textContent = addQuotesTo(document.getElementById('secondPastedIn').value.trim())
    else document.getElementById('secondPasted').textContent = ''
 
    if (document.getElementById('secondTextIn').value.trim()) 
        document.getElementById('secondText').textContent = `text: ${ document.getElementById('secondTextIn').value.trim() }`
    else document.getElementById('secondText').textContent = ''
 



// 3rd (former burial) record
    if (document.getElementById('burSourceIn').value.trim() || document.getElementById('burSourceURLIn').value.trim())
        document.getElementById('burSource').textContent = `\nSOURCE: ${ document.getElementById('burSourceIn').value.trim() }  ${ document.getElementById('burSourceURLIn').value.trim() }` 
    else document.getElementById('burSource').textContent = ''
 

    if (document.getElementById('burPastedIn').value.trim()) 
        document.getElementById('burPasted').textContent = addQuotesTo(document.getElementById('burPastedIn').value.trim())
    else document.getElementById('burPasted').textContent = ''
 
    if (document.getElementById('burTextIn').value.trim()) 
        document.getElementById('burText').textContent = `text: ${ document.getElementById('burTextIn').value.trim() }`
    else document.getElementById('burText').textContent = ''
 




// fourth record
    if (document.getElementById('fourthSourceIn').value.trim() || document.getElementById('fourthSourceURLIn').value.trim())
        document.getElementById('fourthSource').textContent = `\nSOURCE: ${ document.getElementById('fourthSourceIn').value.trim() }  ${ document.getElementById('fourthSourceURLIn').value.trim() }` 
    else document.getElementById('fourthSource').textContent = ''
 
    if (document.getElementById('fourthPastedIn').value.trim()) 
        document.getElementById('fourthPasted').textContent = addQuotesTo(document.getElementById('fourthPastedIn').value.trim())
    else document.getElementById('fourthPasted').textContent = ''
 
    if (document.getElementById('fourthTextIn').value.trim()) 
        document.getElementById('fourthText').textContent = `text: ${ document.getElementById('fourthTextIn').value.trim() }`
    else document.getElementById('fourthText').textContent = ''
 





    if (document.getElementById('graveTextIn').value.trim()) 
        document.getElementById('graveText').textContent = `gravestone: \u0060${ document.getElementById('graveTextIn').value.trim() }\u0060,`
    else document.getElementById('graveText').textContent = ''




 
    if (document.getElementById('probateTextIn').value.trim()) 
        document.getElementById('probateText').textContent = `probate: \u0060${ document.getElementById('probateTextIn').value.trim() }\u0060,`
    else document.getElementById('probateText').textContent = ''

    if (document.getElementById('probateNamesIn').value.trim()) 
        document.getElementById('probateNames').textContent = `namedInProbate: "${ document.getElementById('probateNamesIn').value.trim() }",`
    else document.getElementById('probateNames').textContent = ''


// harvested data

    if (document.getElementById('timestampIn').value.trim()) {
        document.getElementById('timestamp').textContent = `timestamp: "${ document.getElementById('timestampIn').value.trim() }",`
        }
    else document.getElementById('timestamp').textContent = ''


    if (document.getElementById('ofIn').value.trim()) 
        document.getElementById('of').textContent = `of: "${ document.getElementById('ofIn').value.trim() }",`
    else document.getElementById('of').textContent = ''
 
    if (document.getElementById('deathPlaceIn').value.trim()) 
        document.getElementById('deathPlace').textContent = `place: "${ document.getElementById('deathPlaceIn').value.trim() }",`
    else document.getElementById('deathPlace').textContent = ''
 
    if (document.getElementById('ageIn').value.trim()) 
        document.getElementById('age').textContent = `age: "${ document.getElementById('ageIn').value.trim() }",`
    else document.getElementById('age').textContent = ''
 
    if (document.getElementById('causeIn').value.trim()) 
        document.getElementById('cause').textContent = `cause: "${ document.getElementById('causeIn').value.trim() }",`
    else document.getElementById('cause').textContent = ''
 
    if (document.getElementById('informantIn').value.trim()) 
        document.getElementById('informant').textContent = `informant: "${ document.getElementById('informantIn').value.trim() }",`
    else document.getElementById('informant').textContent = ''
 
    if (document.getElementById('mentionedIn').value.trim()) 
        document.getElementById('mentioned').textContent = `mentioned: "${ document.getElementById('mentionedIn').value.trim() }",`
    else document.getElementById('mentioned').textContent = ''
 
    if (document.getElementById('occIn').value.trim()) 
        document.getElementById('occ').textContent = `occ: "${ document.getElementById('occIn').value.trim() }",`
    else document.getElementById('occ').textContent = ''
 
 
    if (document.getElementById('burYearIn').value.trim()) 
        document.getElementById('buryear').textContent = `buryear: "${ document.getElementById('burYearIn').value.trim() }",`
    else document.getElementById('buryear').textContent = ''
 
    if (document.getElementById('burDateIn').value.trim()) 
        document.getElementById('burdate').textContent = `burdate: "${ document.getElementById('burDateIn').value.trim() }",`
    else document.getElementById('burdate').textContent = ''
 
    if (document.getElementById('burPlaceIn').value.trim()) 
        document.getElementById('burplace').textContent = `burplace: "${ document.getElementById('burPlaceIn').value.trim() }",`
    else document.getElementById('burplace').textContent = ''
 
    if (document.getElementById('denominationIn').value.trim()) 
        document.getElementById('denomination').textContent = `denomination: "${ document.getElementById('denominationIn').value.trim() }",`
    else document.getElementById('denomination').textContent = ''


    if (document.getElementById('censusNotes').value) {
        document.getElementById('note').textContent = "notes: \u0060"+document.getElementById('censusNotes').value+"\u0060,"
        }

    if (document.getElementById('censusDisc').value) {
        document.getElementById('discussion').textContent = "discussion: \u0060"+document.getElementById('censusDisc').value+"\u0060,"
        }

    if (document.getElementById('cautionIn').value) {
        document.getElementById('caution').textContent = "caution: \u0060"+document.getElementById('cautionIn').value+"\u0060,"
        }


    /*if (document.getElementById('gpsIn').value.trim()) {
        lines = document.getElementById('gpsIn').value.split('\n')
        output = ''
        for (o=0;o<lines.length;o++) {
            if (lines[o].trim() === '') continue
            temp = lines[o].split(':')
            output += '"'+temp[0]+' https://maps.google.com/maps?q='+temp[1].replace(/ /g,'')+'"'
            if (o<lines.length-1) output += ', '
            }
        document.getElementById('gps').textContent = `gps: [${ output }],`
        }
    else document.getElementById('gps').textContent = ''*/
    

    if (document.getElementById('gpsIn').value.trim()) {
        lines = document.getElementById('gpsIn').value.split('\n')
        output = ''
        for (o=0;o<lines.length;o++) {
            if (lines[o].trim() === '') continue
            console.log('lines',lines[o])
            output += `"${ lines[o] }"`
            if (o<lines.length-1) output += ', '
            }
        document.getElementById('gps').textContent = `gps: [${ output }],`
        }
    else document.getElementById('gps').textContent = ''
    
    

    
    
    if (document.getElementById('recordsIn').value.trim()) {
        var imagesArray = []
        imagesArray = document.getElementById('recordsIn').value.split('\n')

        var imagesOut = ''
        for (i=0;i<imagesArray.length;i++) {
            if (imagesArray[i].trim() === '') continue
            parts = imagesArray[i].split(' ')
            if (imagesArray[i].match('http')) {} //
            else parts[parts.length-1] = 'url:../'+project+'_records/'+parts[parts.length-1]
            //if (! imagesArray[i].includes('url:records')) parts[parts.length-1] = 'url:records/'+parts[parts.length-1]
            imagesOut += '"'+parts.join(' ').trim()+'"'
            if (i<imagesArray.length-1) imagesOut += ', '
            }
        if (imagesArray.length > 0) document.getElementById('images').textContent = 'images: ['+imagesOut+'],'
        }
    else document.getElementById('images').textContent = ''



        
    if (document.getElementById('censusDisc').value) {
        document.getElementById('discussion').textContent = "discussion: \u0060"+document.getElementById('censusDisc').value+"\u0060,"
        }

    if (document.getElementById('cautionIn').value) {
        document.getElementById('caution').textContent = "caution: \u0060"+document.getElementById('cautionIn').value+"\u0060,"
        }




    // check for timestamp
    if (document.getElementById('timestamp').textContent === '') {
        document.getElementById('timestamp').textContent = 'Add timestamp'
        document.getElementById('timestamp').style.background = 'red'
        document.getElementById('timestamp').style.color = 'white'
        }
    else {
        document.getElementById('timestamp').style.background = 'white'
        document.getElementById('timestamp').style.color = 'brown'
        }

   }


function checkDB (fieldname, dbfield, checkID) {
    // checks certain values against what currently in the top-level db, and raises flags if they differ

    thisPerson = document.getElementById('idIn').value.trim()

    if (document.getElementById(fieldname).value.trim() !== db[thisPerson][dbfield])  document.getElementById(checkID).textContent = `The database currently has ${ db[thisPerson][dbfield] }`
    else { document.getElementById(checkID).textContent = `` }

    }


function getMonthOnly (MMM) {
    // converts Jan to 01, and so on
    switch (MMM.toLowerCase()) {
        case 'jan': return '01'
        case 'feb': return '02'
        case 'mar': return '03'
        case 'apr': return '04'
        case 'may': return '05'
        case 'jun': return '06'
        case 'jul': return '07'
        case 'aug': return '08'
        case 'sep': return '09'
        case 'oct': return '10'
        case 'nov': return '11'
        case 'dec': return '12'
        default: return '???'
        }
    }


function getMonth (dateValue) {
console.log(dateValue)
    parts = dateValue.replace('~','').split(' ')
    while (parts[0].length < 2) parts[0] = '0'+parts[0]
    month = ''
    switch (parts[1].toLowerCase()) {
        case 'jan': month = '01'; break
        case 'feb': month = '02'; break
        case 'mar': month = '03'; break
        case 'apr': month = '04'; break
        case 'may': month = '05'; break
        case 'jun': month = '06'; break
        case 'jul': month = '07'; break
        case 'aug': month = '08'; break
        case 'sep': month = '09'; break
        case 'oct': month = '10'; break
        case 'nov': month = '11'; break
        case 'dec': month = '12'; break
        }
    return month+'-'+parts[0]
    }


    
function getMonthOLD (dateValue) {
    parts = dateValue.replace('~','').split(' ')
    while (parts[0].length < 2) parts[0] = '0'+parts[0]
    month = ''
    switch (parts[1]) {
        case 'Jan': month = '01'; break
        case 'Feb': month = '02'; break
        case 'Mar': month = '03'; break
        case 'Apr': month = '04'; break
        case 'May': month = '05'; break
        case 'Jun': month = '06'; break
        case 'Jul': month = '07'; break
        case 'Aug': month = '08'; break
        case 'Sep': month = '09'; break
        case 'Oct': month = '10'; break
        case 'Nov': month = '11'; break
        case 'Dec': month = '12'; break
        }
    return month+'-'+parts[0]
    }

</script>
</head>

<body>
<div id="out">
  <div id="banner">
    <div id="pagetitle">Death record entry<br>
    </div>
  </div>
  <div id="subbanner">
    <div><a id="birthLink" href="birthentry.html" target="_blank">Birth</a> • <a id="marriageLink" href="marriageentry.html" target="_blank">Marriage</a> • <a id="censusLink" href="censusentry.html" target="_blank">Census</a> • <a id="eventLink" href="evententry.html" target="_blank">Event</a></div>
    <!--<div><a href="birthentry.html">Birth</a> • <a href="marriageentry.html">Marriage</a> • <a href="censusentry.html">Census</a></div>-->
  </div>
  <div id="subsubbanner">
    <div>
<!--<input type="text" id="idIn" style="width:200px;" placeholder="Add ID, then click on 🔁."
onInput="document.getElementById('idIn').textContent = '&quot;id: '+this.value+'&quot;,';"
onChange="autoPropagate(this.value);"/> <span class="redo" onClick="autoPropagate(document.getElementById('idIn').value);">🔁</span> <span class="redo"><a id="clearAll" href="">❌</a></span>-->

<input type="text" id="idIn" style="width:200px;" placeholder="Add ID, then click on [Load].">
<button id="load" title="Load data for this person" onclick="document.location=`dthentry.html?project=${ project }&person=${ document.getElementById('idIn').value }`">Load</button>
<button id="clearAll" onClick="document.location=`dthentry.html?project=${ project }`" style="margin-inline-start:3rem;">❌&nbsp; Clear the form</button>
    </div>
  </div>
  <div id="main">




<div id="references">
</div>


<div id="certificateTemplate" style="min-width: 10rem;">

<p style="font-style: italic;">Use these templates to<br>
speed up data entry.</p>

<h3>Certificate</h3>
<textarea onClick="this.select()">When:&nbsp;
Where:&nbsp;
Name:&nbsp;
Age:&nbsp;
Occupation:&nbsp;
Cause:&nbsp;
Informant:&nbsp;
Reg date:&nbsp;
</textarea>
</div>

<div id="parishTemplate" style="min-width: 10rem;">
<h3>Parish record</h3>
<textarea onClick="this.select()">Parish:&nbsp;
When:&nbsp;
Name:&nbsp;
Age:&nbsp;
Occ:&nbsp;
Abode:&nbsp;
</textarea>
</div>



<p style="margin: 0 4rem; font-style: italic; font-size: 85%;">If you have scans of certificates or parish records, etc. point to them in the section "Record scans".<br>
The "Source #1" and other numbered headings allow you to capture the information from a single source. (On a person summary page that information is revealed by clicking on a black triangle to the right.)<br>
The fields under "Data for building the page"  contain text snippets that will be used to build the person's summary page. (The data should be extracted from the sources, and is structured in a way that it can be successfully inserted into the person's summary page.)</p>

   
<summary style="margin-block:1rem; font-style: italic;">Converter</summary>
   <p style="margin: 0 4rem; font-style:italic; color: teal;"><textarea id="copyIn" placeholder="This is a temporary field. Drop OLD data into the textarea and click GO. This function finds stuff to put in the page building data list." style="width: 36rem; height: 4rem;"></textarea> <button onClick="doConversion()">GO</button></p>


<details id="index" open>
<summary class="heading">Source #1</summary>
<table>
<tr>
<td>Source:</td>
<td><input type="text" id="indexSourceIn" class="sourceBox"
    placeholder="Source name"
    onInput="draftResult()">
    <input type="text" id="indexSourceURLIn" class="sourceBox"
    placeholder="Source URL"
    onInput="draftResult()">
    <button onClick="openWindow(document.getElementById('indexSourceURLIn').value)">GO</button>
    </td>
</tr>
<tr>
<td>Key-value<br>pairs:<br><button 
        onClick="document.getElementById('indexPastedIn').value = tabs2colons(document.getElementById('indexPastedIn').value)">Add colons</button></td>
<td><textarea id="indexPastedIn" class="tallPasteBox"
    placeholder="Copy-paste lists here from transcript pages. (Only lines with a colon are captured.)"
    onInput="draftResult()"></textarea>
    </td>
</tr>
<tr>
<td>Text:</td>
<td><textarea id="indexTextIn" class="textBox" 
    placeholder="Copy-paste or write textual information here.)"
    onInput="draftResult()"></textarea>
    </td>
</tr>
</table>
</details>













<details id="second">
<summary class="heading">Source #2</summary>
<table>
<tr>
<td>Source:</td>
<td><input type="text" id="secondSourceIn" class="sourceBox"
    placeholder="Source name"
    onInput="draftResult()">
    <input type="text" id="secondSourceURLIn" class="sourceBox"
    placeholder="Source URL"
    onInput="draftResult()">
    <button onClick="openWindow(document.getElementById('secondSourceURLIn').value)">GO</button>
    </td>
</tr>
<!--tr>
<td>Image:</td>
<td><input type="text" id="secondImageIn" class="imageBox" 
    placeholder="File name of image in 'records' folder (no ext)"
    onInput="draftResult()">
    <input type="text" id="secondImageExtIn" class="extBox" value=".jpg" 
    placeholder="Extension"
    onInput="draftResult()">
    <button onClick="openRecord(document.getElementById('secondImageIn').value, document.getElementById('secondImageExtIn').value)">GO</button>
    </td>
</tr-->
<tr>
<td>Key-value<br>pairs:<br><button 
        onClick="document.getElementById('secondPastedIn').value = tabs2colons(document.getElementById('secondPastedIn').value)">Add colons</button></td>
<td><textarea id="secondPastedIn" class="tallPasteBox"
    placeholder="Copy-paste lists here from transcript pages. (Only lines with a colon are captured.)"
    onInput="draftResult()"></textarea>
    <span class="copy" title='Remove "[...]", when copying legacy.' onClick="removeBrackets(document.getElementById('secondPastedIn'))    ">✚</span>
    </td>
</tr>
<tr>
<td>Text:</td>
<td><textarea id="secondTextIn" class="textBox" 
    placeholder="Copy-paste or write textual information here.)"
    onInput="draftResult()"></textarea>
    </td>
</tr>
</table>
</details>









<details id="bur">
<summary class="heading">Source #3</summary>
<table>
<tr>
<td>Source:</td>
<td><input type="text" id="burSourceIn" class="sourceBox"
    placeholder="Source name"
    onInput="draftResult()">
    <input type="text" id="burSourceURLIn" class="sourceBox"
    placeholder="Source URL"
    onInput="draftResult()">
    <button onClick="openWindow(document.getElementById('burSourceURLIn').value)">GO</button>
    </td>
</tr>
<!--tr>
<td>Image:</td>
<td><input type="text" id="burImageIn" class="imageBox" 
    placeholder="File name of image in 'records' folder (no ext)"
    onInput="draftResult()">
    <input type="text" id="burImageExtIn" class="extBox" value=".jpg"
    placeholder="Extension"
    onInput="draftResult()">
    <button onClick="openRecord(document.getElementById('burImageIn').value, document.getElementById('burImageExtIn').value)">GO</button>
    </td>
</tr-->
<tr>
<td>Key-value<br>pairs:<br><button 
        onClick="document.getElementById('burPastedIn').value = tabs2colons(document.getElementById('burPastedIn').value)">Add colons</button></td>
<td><textarea id="burPastedIn" class="tallPasteBox"
    placeholder="Copy-paste lists here from transcript pages. (Only lines with a colon are captured.)"
    onInput="draftResult()"></textarea>
    <span class="copy" title='Remove "[...]", when copying legacy.' onClick="removeBrackets(document.getElementById('burPastedIn'))    ">✚</span>
    </td>
</tr>
<tr>
<td>Text:</td>
<td><textarea id="burTextIn" class="textBox" 
    placeholder="Copy-paste or write textual information here.)"
    onInput="draftResult()"></textarea>
    </td>
</tr>
</table>
</details>









<details id="fourth">
<summary class="heading">Source #4</summary>
<table>
<tr>
<td>Source:</td>
<td><input type="text" id="fourthSourceIn" class="sourceBox"
    placeholder="Source name"
    onInput="draftResult()">
<input type="text" id="fourthSourceURLIn" class="sourceBox"
    placeholder="Source URL"
    onInput="draftResult()">
<button onClick="openWindow(document.getElementById('fourthSourceURLIn').value)">GO</button>
</td>
</tr>
<!--tr>
<td>Image:</td>
<td><input type="text" id="fourthImageIn" class="imageBox" 
    placeholder="File name of image in 'records' folder (no ext)"
    onInput="draftResult()">
<input type="text" id="fourthImageExtIn" class="extBox" value=".jpg"
    placeholder="Extension"
    onInput="draftResult()">
<button onClick="openRecord(document.getElementById('fourthImageIn').value, document.getElementById('fourthImageExtIn').value)">GO</button>
</td>
</tr-->
<tr>
<td>Key-value<br>pairs:<br><button 
        onClick="document.getElementById('fourthPastedIn').value = tabs2colons(document.getElementById('fourthPastedIn').value)">Add colons</button></td>
<td><textarea id="fourthPastedIn" class="tallPasteBox"
    placeholder="Copy-paste lists here from transcript pages. (Only lines with a colon are captured.)"
    onInput="draftResult()"></textarea>
<span class="copy" title='Remove "[...]", when copying legacy.' onClick="removeBrackets(document.getElementById('fourthPastedIn'))    ">✚</span>
</td>
</tr>
<tr>
<td>Text:</td>
<td><textarea id="fourthTextIn" class="textBox" 
    placeholder="Copy-paste or write textual information here.)"
    onInput="draftResult()"></textarea>
</td>
</tr>
</table>
</details>



<script>
function removeBrackets (node) {
    // removes "[ and ]", from copied older records
    out = node.value.replace(/\]",/g,'').replace(/"\[/g,'')
    node.value = out  
    }
</script>





<details>
<summary class="heading">Grave &amp; Probate text</summary>
<table>
<tr>
<td>Grave inscription:</td>
<td><textarea id="graveTextIn" class="tallPasteBox"  style="color:red;"
    placeholder="Copy-paste or write the inscription here. This will be shown on the person's summary page."
    onInput="draftResult()"></textarea>
</td>
</tr>
<tr>
<td>Probate text:</td>
<td><textarea id="probateTextIn" class="tallPasteBox"   style="color:red;"
    placeholder="Copy-paste or write the probate summary text here. This will be shown on the person's summary page."
    onInput="draftResult()"></textarea>
    </td>
</tr>
<tr>
<td>Named in probate:</td>
<td><input type="text" id="probateNamesIn"  
        placeholder="Comma-separated list of people named in probate or wills. Use ids where available." class="wideInputBox"
        onInput="draftResult()">
    </td>
</tr>
</table>
</details>





<details open>
<summary class="heading">Record scans</summary>
<table>
<tr>
<td>Data:</td>
<td><textarea id="recordsIn" class="mediumPasteBox"
    placeholder="Add the link text you want, followed by the filename+ext. One link per line."
    onInput="draftResult()"></textarea>
</td>
</tr>
<tr>
<td>&nbsp;</td>
<td><input type="file" multiple id="getFileName" style="width:40em;" onInput="draftResult()" placeholder="A comma-separated list of filenames (no extension)"></td>
<script>
document.getElementById('getFileName').addEventListener('change', function(event) {
    const files = event.target.files
    out = ''
    for (let i = 0; i < files.length; i++) {
        if (i>0) out += '\n'
        out += files[i].name
        //console.log('File name:', files[i].name)
        }
    document.getElementById('recordsIn').value += out
    })
</script>
</tr>
<tr>
<td>Test box:</td>
<td><input type="text" id="recordTester" class="imageBox" 
    placeholder="Copy filename here & press GO to see the record.">
    <input type="text" id="recordTesterExtIn" class="extBox" value=".jpg" 
    placeholder="Extension">
    <button onClick="openRecord(document.getElementById('recordTester').value, document.getElementById('recordTesterExtIn').value)">GO</button>
    </td>
</tr>
</table>
</details>











<table style="margin-inline-start: 2rem; margin-block-start: 4rem; color: teal;">
<tr>
<td colspan="2" class="heading">Data for building the page</td></tr>
 
     <tr>
        <td>Timestamp:</td>
        <td colspan="3"><input type="text" id="timestampIn"
            placeholder="YYYY-MM-DD"
            onInput="draftResult()"
            onChange="draftResult()"
            >
            </td>
      </tr>
<tr>
<td>Abode:</td>
<td><input type="text" id="ofIn"  list="gpsList"
    placeholder="Place where they lived." class="wideInputBox"
    onFocus="checkDB('deathPlaceIn', 'dplace', 'dplaceCheck')"
    onInput="draftResult()">
    <span class="instructions" id="dplaceCheck" style="color:red;"></span>
    </td>
</tr>
<tr>
<td>Place of death:</td>
<td><input type="text" id="deathPlaceIn"   list="gpsList"
    placeholder="Place where they died (if different)." class="wideInputBox"
    onInput="draftResult();">
    </td>
</tr>
      <tr>
        <td>Burial place:</td>
        <td><input type="text" id="burPlaceIn"   list="gpsList"
            placeholder="Cemetery, town, county, etc." class="wideInputBox"
            onInput="draftResult()"> 
            <!--<span class="copy" title="Add to metadata." onClick="document.getElementById('burPlace').textContent = '&quot;burplace: '+document.getElementById('burPlaceIn').value+'&quot;,'; document.getElementById('deathPlaceIn').value = document.getElementById('burPlaceIn').value;">✚</span>--></td>
      </tr>
     <tr>
        <td>Date of death:</td>
        <td colspan="3"><input type="text" id="deathDateIn"
            placeholder="DD MMM or MMM-MMM, etc."
            onFocus="checkDB('deathDateIn', 'ddate', 'ddateCheck')">
            <span class="instructions" id="ddateCheck" style="color:red;"></span>      
            </td>
      </tr>
     <tr>
        <td>Year of death:</td>
        <td colspan="3"><input type="text" id="deathYearIn"
            placeholder="YYYY"
            onFocus="checkDB('deathYearIn', 'd', 'dCheck')">
            <span class="instructions" id="dCheck" style="color:red;"></span>
<script>
function makeTimestamp () {
    daymonth = document.getElementById('deathDateIn').value.trim()
    year = document.getElementById('deathYearIn').value.trim()   
    if (daymonth.match('-')) {
        switch (daymonth) {
            case 'Jan-Mar': out = "02-15"; break
            case 'Apr-Jun': out = "05-15"; break
            case 'Jul-Sep': out = "08-15"; break
            case 'Oct-Dec': out = "11-15"; break
            default: out = daymonth
            }
        document.getElementById('timestampIn').value = year+'-'+out
        } 
    else if (daymonth.match('~')) {
        daymonth = daymonth.replace(/~/,'')+' 15'
        document.getElementById('timestampIn').value = year+'-'+getMonth(daymonth)
        }
    else {
        components = daymonth.split(' ')
        document.getElementById('timestampIn').value = year+'-'+getMonth(daymonth)
        }
    }
</script>
    <button class="copy" title="Add timestamp." onClick="makeTimestamp()">Make time stamp</button></td>
    </tr>
      <tr>
        <td>Burial date:</td>
        <td><input type="text" id="burDateIn"  
            placeholder="DD MMM"
        onInput="draftResult()">
        </td>
      </tr>
      <tr>
        <td>Burial year:</td>
        <td><input type="text" id="burYearIn"  
            placeholder="YYYY"
            onInput="draftResult()">
            <button class="copy" title="Add timestamp & approx birth." onClick="
            daymonth = document.getElementById('burDateIn').value.trim()
            year = document.getElementById('burYearIn').value.trim()
            document.getElementById('deathYearIn').value = year
            document.getElementById('deathDateIn').value = '~'+daymonth
            components = daymonth.split(' ')
            document.getElementById('timestampIn').value = year+'-'+getMonth(daymonth)
            ">Make time stamp</button>
            </td>
      </tr>
<tr>
<td>Age:</td>
<td><input type="text" id="ageIn"  
    placeholder="DD (actual)"
    onInput="draftResult()"></td>
</tr>
<tr>
<td>Cause:</td>
<td><input type="text" id="causeIn" 
    placeholder="Cause (certified?)" class="wideInputBox"
    onInput="draftResult()"></td>
</tr>
<tr>
<td>Informant:</td>
<td><input type="text" id="informantIn"  
    placeholder="Name, relation, residence, present at death?" class="wideInputBox"
    onInput="draftResult()"></td>
</tr>
<tr>
<td>Mentions:</td>
<td><input type="text" id="mentionedIn"  
    placeholder="Comma-separated list of ids for people not mentioned elsewhere." class="wideInputBox"
    onInput="draftResult()"></td>
</tr>
<tr>
<td>Occupation:</td>
<td><input type="text" id="occIn" 
    placeholder="Add if you can." class="wideInputBox"
    onInput="draftResult()"></td>
</tr>


      <tr>
        <td>Denomination:</td>
        <td><input type="text" id="denominationIn"  
            placeholder="Religion" class="wideInputBox"
            onInput="draftResult()">
            </td>
      </tr>
      <!--tr>
        <td>Named in probate:</td>
        <td><input type="text" id="probateNamesIn"  
            placeholder="Comma-separated list of people named in probate or wills. Use ids where available." class="wideInputBox"
            onInput="draftResult()">
            </td>
      </tr-->




<!--tr>
        <td>GPS:</td>
        <td><select id="gpsList" onChange="
            newline = ''
            if (document.getElementById('gpsIn').value === '') {}
            else newline = '\n'
            document.getElementById('gpsIn').value += newline+this.value
            draftResult()
            "></select></td>
      </tr-->

      <tr>
        <td>GPS:</td>
        <td>
        <button title="Add a template for a new place" onClick="newline = ''
            if (document.getElementById('gpsIn').value === '') {}
            else newline = '\n'
            document.getElementById('gpsIn').value += newline+`xxxx https://www.google.com/maps?q=xxx`
            draftResult()">New</button>
        <input id="findBlock" type="text" list="gpsList" placeholder="Search for known places" style="width:29em" onchange="
            newline = ''
            if (document.getElementById('gpsIn').value === '') {}
            else newline = '\n'
            document.getElementById('gpsIn').value += newline+this.value
            draftResult()
            this.value = ''">
        <datalist id="gpsList"></datalist>
        </td>
        <!--td><select id="gpsList" onChange="
            newline = ''
            if (document.getElementById('gpsIn').value === '') {}
            else newline = '\n'
            document.getElementById('gpsIn').value += newline+this.value
            draftResult()
            "></select></td-->
      </tr>


<tr>
        <td>GPS:</td>
        <td colspan="3"><textarea id="gpsIn" onInput="draftResult()" placeholder="Use the selection control above or type directly to add locations here, one per line. The end result should look like this: Blakemore Gate https://www.google.com/maps?q=52.6040598, -2.9199274"></textarea></td>
      </tr>




      <tr>
        <td>Notes:</td>
        <td><textarea id="censusNotes"
            onInput="draftResult()"
            placeholder="Can be multi-line. Each line can optionally begin with intro: or quote: (or note:, but that's the default). Intro lines are italicised, and should be used only to introduce the note. Quote lines receive quote marks and italicisation."></textarea></td>
      </tr>
      <tr>
        <td>FNotes:</td>
        <td><textarea id="censusFNotes"
            onInput="makeNotes(this.value,'fnote')"
            placeholder="Each paragraph here will be listed below the entry as footnotes.  Like for the notes field, use {xxxx:kx} for people's names."></textarea></td>
      </tr>
      <tr>
        <td>Discussion:</td>
        <td><textarea id="censusDisc"
            onInput="draftResult()"
            placeholder="This is for commentary on the entry, such as to justify choices made. Discussion text is not displayed on the general UI, but a speech bubble icon is added. Click on the icon or reveal the sources to see the text."></textarea></td>
      </tr>
      <tr>
        <td>Caution:</td>
        <td><textarea id="cautionIn"
            onInput="draftResult()"
            placeholder="Use to draw attention to guesswork or items needing further corroboration, etc. Text is displayed by clicking on a warning icon in the person summary page."></textarea></td>
      </tr>
   </table>
   
      
   
   <script>
   // drop OLD data into the textarea and click GO
   // this function finds stuff to put in the page building data list
   function doConversion () {
        lines = document.getElementById('copyIn').value.split('\n')
        for (i=0;i<lines.length;i++) {
            lines[i] = lines[i].trim().replace(/"/g,'')
            if (lines[i] === '') continue
            console.log(lines[i])
            
            if (lines[i].startsWith('year:')) outId = 'deathYearIn'
            
            else if (lines[i].startsWith('date:')) outId = 'deathDateIn'
            
            else if (lines[i].startsWith('place:')) outId = 'deathPlaceIn'
            
            else if (lines[i].startsWith('buryear:')) outId = 'burYearIn'
            
            else if (lines[i].startsWith('burdate:')) outId = 'burDateIn'
            
            else if (lines[i].startsWith('burplace:')) outId = 'burPlaceIn'
            
            else if (lines[i].startsWith('of:')) outId = 'ofIn'
            
            else if (lines[i].startsWith('age:')) outId = 'ageIn'
            
            else if (lines[i].startsWith('occ:')) outId = 'occIn'
            
            else if (lines[i].startsWith('cause:')) outId = 'causeIn'
            
            else if (lines[i].startsWith('informant:')) outId = 'informantIn'
            
            else if (lines[i].startsWith('mentioned:')) outId = 'mentionedIn'
            
            else outId = ''
            
            value = lines[i].split(':')
            if (outId) document.getElementById(outId).value = value[1].replace(/,$/,'').trim()
            console.log(value[1].replace(/,$/,'').trim())
            }
        
        // create the timestamp
        if (document.getElementById('deathDateIn').value !== '' && document.getElementById('deathYearIn').value !== '') document.getElementById('timestampIn').value = document.getElementById('deathYearIn').value+'-'+getMonth(document.getElementById('deathDateIn').value)
        }
   </script>
    
    
    <!--<p style="text-align: center;"><button style="font-size: 2rem; background-color: antiquewhite; border-radius: 1rem; padding-inline: .5rem; box-shadow: none; border: 1px solid beige;" onClick="draftResult();">Generate data</button></p>-->

    <div title="Copy data to clipboard" style="margin-block-start: 2rem; text-align: center; font-size: 2rem; background-color: antiquewhite; border-radius: 1rem; padding-inline: .5rem; box-shadow: none; border: 1px solid beige; cursor: pointer;" onclick="console.log(prepCopy()); navigator.clipboard.writeText(prepCopy()); document.getElementById('copyNotice').style.display = 'block'; setTimeout(() => { document.getElementById('copyNotice').style.display = 'none' }, '500')">Copy
    <img src="../../lib/i/copytiny.svg" alt="" style="height:1em; width:1em; vertical-align: middle;">
    </div>

   <p class="" style="margin: 4rem 0 0 2rem; font-style:italic; color: teal;">When all the data is entered, copy the text below to the db.js file.</p>
   
   
    <div id="draft" contenteditable style="margin:2rem; color: brown;">
      <!--<div id="start">death: {</div>-->
      <div id="timestamp"></div>
      <!--div id="id"></div-->
      <div id="name"></div>
      <div id="of"></div>
      <div id="deathPlace"></div>
      <div id="age"></div>
      <div id="cause"></div>
      <div id="occ"></div>

      <div id="buryear"></div>
      <div id="burdate"></div>
      <div id="burplace"></div>
      <div id="denomination"></div>

      <div id="father"></div>
      <div id="fatherId"></div>
      <div id="focc"></div>
      <div id="mother"></div>
      <div id="motherId"></div>
      <div id="informant"></div>
      <div id="mentioned"></div>
      <div id="probateNames"></div>
      <div id="probateText" style="white-space: pre;"></div>
      <div id="graveText" style="white-space:pre-line"></div>

      <div id="images"></div>
      <div id="gps"></div>

      <div id="note" style="white-space: pre;"></div>
      <div id="fnote"></div>
      <div id="discussion" style="white-space: pre;"></div>
      <div id="caution" style="white-space: pre;"></div>

      
      <div>sources: `</div>

      <!-- index -->
      <div id="indexSource" style="white-space: pre;"></div>
      <div id="indexText"></div>
      <div id="indexName"></div>
      <div id="indexAge"></div>
      <div id="indexPasted" style="white-space:pre-line"></div>
      <div id="deathRecord"></div>
      
      <!-- certificate -->
      <div id="certSource" style="white-space: pre;"></div>
      <div id="certImage"></div>
      <div id="certWhen"></div>
      <div id="certWhere"></div>
      <div id="certName"></div>
      <div id="certAge"></div>
      <div id="certOcc"></div>
      <div id="certCause"></div>
      <div id="certInformant"></div>
      <div id="certRegd"></div>
      <div id="certOther" style="white-space:pre-line"></div>
      
      <!-- 2nd source -->
      <div id="secondSource" style="white-space: pre;"></div>
      <div id="secondImage"></div>
      <div id="secondPasted" style="white-space:pre-line"></div>
      <div id="secondText"></div>
      
      <!-- burial -->
      <div id="burSource" style="white-space: pre;"></div>
      <div id="burImage"></div>
      <div id="burText"></div>
      <div id="burName"></div>
      <div id="burAbode"></div>
      <div id="burAge"></div>
      <div id="burPasted" style="white-space:pre-line"></div>
      
      <!-- 4th source -->
    <div id="fourthSource" style="white-space: pre;"></div>
    <div id="fourthImage"></div>
    <div id="fourthPasted" style="white-space:pre-line"></div>
    <div id="fourthText"></div>
      
    <!-- gravestone -->
      <div id="graveSource" style="white-space: pre;"></div>
      <div id="graveImage"></div>

      <!-- probate -->
      <div id="probateSource" style="white-space: pre;"></div>
      <div id="probateImage"></div>
      <div id="probatePasted"></div>

      <div id="end">`<!--},--></div>
      </div>



<script>
function prepCopy () {
    var draft, copied, divs
    
    draft = document.getElementById('draft')
    copied = ''
    divs = draft.querySelectorAll('div')
    for (i=0;i<divs.length;i++) {
        if (divs[i].textContent.trim() !== '') copied += divs[i].textContent+'\n'
        }
    return copied
    }



function prepCopyX () {
    draft = document.getElementById('draft')
    copied = document.getElementById('draftCopy')
    copied.value = ''
    divs = draft.querySelectorAll('div')
    for (i=0;i<divs.length;i++) {
        if (divs[i].textContent.trim() !== '') copied.value += divs[i].textContent+'\n'
        }
    copied.focus()
    copied.select()
    document.execCommand('copy')
    return false
    }
</script>
<!--<div style="text-align: center;"><button  style="font-size: 2rem;" onClick="prepCopy()">Copy</button> <textarea style="block-size:2rem;inline-size:1rem; vertical-align: bottom;" id="draftCopy"></textarea></div>-->

    
    <p style="text-align: center;"><button style="font-size: 1.5rem; background-color: antiquewhite; border-radius: 1rem; padding-inline: .5rem; box-shadow: none; border: 1px solid beige;" onClick="draftResult();">Regenerate with timestamp</button></p>


      
    <pre id="places">
    </pre>
  </div>
</div>

<dialog id="copyNotice">Copied !</dialog>


<script>
document.getElementById('clearAll').href = document.location
</script>
</body>
</html>